<!DOCTYPE html>
<html lang="en">
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
      charset="UTF-8"
    />
    <title>The Campus Wall</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <h1>The Campus Wall</h1>
      <p class="subtitle">Anonymous wins, confessions & thoughts</p>
      <a href="create.html" class="create-btn">Create Post</a>
    </header>

    <!-- Category Filter -->
    <div class="filters">
      <button class="filter active" data-filter="all">All</button>
      <button class="filter" data-filter="win">Wins</button>
      <button class="filter" data-filter="confession">Confessions</button>
      <button class="filter" data-filter="thought">Thoughts</button>
    </div>

    <!-- Posts Wall -->
    <main class="wall" id="wall">
      <div class="post-card" data-category="win" onclick="openModal()"></div>
    </main>

    <!-- Modal -->
    <div class="modal" id="postModal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">Ã—</span>

        <span class="tag"></span>
        <h2></h2>
        <p class="full-text"></p>
      </div>
    </div>

    <!-- Render posts from localStorage -->
    <script>
      const wall = document.getElementById("wall");

      function renderPosts(filter = "all") {
        const wall = document.getElementById("wall");
        wall.innerHTML = "";

        const posts = JSON.parse(localStorage.getItem("posts")) || [];

        posts.forEach((post) => {
          if (filter !== "all" && post.tag !== filter) return;

          const card = document.createElement("div");
          card.className = "post-card";
          card.onclick = () => openModal(post);

          card.innerHTML = `
      <span class="tag ${post.tag}">${post.tag}</span>
      <h3>${post.title}</h3>
      <p class="preview">${post.content.slice(0, 100)}...</p>
      <button class="delete-btn" onclick="deletePost(${
        post.id
      }, event)">Delete</button>
    `;

          wall.appendChild(card);
        });
      }

      // initial load
      renderPosts();
    </script>
    <script>
      function deletePost(postId, event) {
        event.stopPropagation();

        if (!confirm("Delete this post?")) return;

        let posts = JSON.parse(localStorage.getItem("posts")) || [];
        posts = posts.filter((post) => post.id !== postId);
        localStorage.setItem("posts", JSON.stringify(posts));

        const activeFilter =
          document.querySelector(".filter.active")?.dataset.filter || "all";

        renderPosts(activeFilter); // ðŸ”¥ immediate UI update
      }
    </script>

    <script>
      function openModal(post) {
        const modal = document.getElementById("postModal");

        modal.style.display = "flex";

        modal.querySelector(".tag").innerText = post.tag;
        modal.querySelector(".tag").className = `tag ${post.tag}`;

        modal.querySelector("h2").innerText = post.title;
        modal.querySelector(".full-text").innerText = post.content;
      }

      function closeModal() {
        document.getElementById("postModal").style.display = "none";
      }
    </script>

    <!-- Filter logic -->
    <script>
      const filterButtons = document.querySelectorAll(".filter");

      filterButtons.forEach((button) => {
        button.addEventListener("click", () => {
          filterButtons.forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");

          const filter = button.getAttribute("data-filter");
          renderPosts(filter);
        });
      });
    </script>
  </body>
</html>
